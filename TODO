    麻雀ゲーム TODO リスト

[保守性リスク（最優先で是正）]
☐ 表示順依存の入力判定（右端ツモ固定の当たり判定が描画順に結合）
  - レイアウト変更で壊れる。座標→牌IDのマッピングテーブルを導入して、入力は描画から独立させる。
☐ 状態と描画/入力の密結合（MahjongGameがすべて担う）
  - モジュール境界が曖昧で拡張しにくい。Core（状態/進行）・Presenter（描画）・Controller（入力）への分離を計画。
☐ 初期化の多重化/副作用順序依存（new-game時、init前に個別初期化＋init内でも初期化）
  - 初期化ルーチンを一箇所に集約（GameStateFactoryを作り、UIイベントは常に新規State生成→描画）。
☐ デバッグ配牌で山との整合性崩壊の可能性
  - 直接上書きではなく「山から牌を交換」してトラッキング整合を保つ。牌ID付与で完全追跡。
☐ グローバル(window)への依存（calcYaku/YAKU_LISTのバインド）
  - ESM移行後も残存。MahjongGameへ明示的に依存注入（コンストラクタ引数）し、window依存を排除。
☐ 例外処理/エラーハンドリング不足
  - 山切れ/描画エラー/イベント競合時のフォールバックがない。try-catchとユーザ通知、ログ基盤を整備。
☐ テスト欠如（役判定/面子分解/進行/入力）
  - ユニット/統合テストを最低限用意。yaku.jsはデータ駆動テスト、進行は状態遷移テストを導入。
☐ 時間依存ロジック（setTimeout）と状態不整合のリスク
  - ステートマシン導入（Idle/Draw/Discard/Calls/Resolve/EndHand）。イベントキューで順序保証。
☐ ES Modules前提の配信手段（file://不可）に対する開発フロー
  - ローカルHTTPサーバ（npm script/Live Server）をREADME/TODOに明記し、誰でも再現できる手順化。

[基本ルール/進行]
☐ 自摸・打牌サイクルの厳密化（配牌/王牌/ドラ表示/流局処理/連荘）
☐ ツモ番以外のロン（他家打牌に対する和了）イベントの実装
☐ ポン/チー/カンの鳴き処理（優先順位、同時発生時の裁定、発声タイミング）
☐ 嶺上開花/槍槓/搶槓/海底摸月/河底撈魚/ダブル立直など特殊状況処理
☐ カン（暗槓/明槓/加槓）の実装とドラ増加・嶺上処理
☐ 流局（九種九牌/四風連打/四家立直/四開槓/三家和了/途中流局）判定
☐ 圧倒的に少ない山の管理を厳密化（王牌/ドラ表示牌/カンドラ/裏ドラ確保）

[得点計算/役関連]
☐ 役判定の厳密化（現在は簡易）: 平和の待ち形/一盃口の厳密重複/三暗刻の鳴き区別 など
☐ 役一覧の拡充（ダブル一盃口/混老頭/純全帯么九/混全帯么九/小三元/大三元/小四喜/大四喜/字一色/九蓮宝燈/清老頭/四暗刻/四暗刻単騎/緑一色/天和/地和 など）
☐ 門前/鳴きによる食い下がり対応（例: 一気通貫/三色同順/混一色/清一色など）
☐ 自風/場風の役牌対応（現在は白發中のみ）
☐ ドラ/赤ドラ/裏ドラ/カンドラ/カン裏の加算
☐ 符計算/翻数からの点数計算実装（ツモ/ロン、親/子での支払い計算、オーラス処理）
☐ 複数形の分解候補から最大点構成の探索（現在は最初に見つかった分解のみ）

[UI/UX]
☐ 捨て牌に実牌を描画（現在は矩形のみ）＋ツモ切り/手出しの表示差
☐ 自家の待ち牌ハイライト/聴牌表示/向聴数表示（オプション）
☐ 立直ボタン/自動和了/自動ツモ切り設定
☐ 鳴き可否のポップアップ/選択UI（スキップ含む）
☐ ドラ表示エリア/場風/自風/局数/本場/供託の表示
☐ 画面リサイズ対応/モバイル最適化
☐ アニメーション（ツモ/打牌/鳴き/リーチ宣言/ドラ反転）

[AI/対戦ロジック]
☐ 他家の思考ロジック強化（現状はランダム打牌）
☐ 他家の鳴き判断/和了判断/立直判断
☐ 難易度設定/戦略パラメータ

[システム/設計]
☐ 役判定(yaku.js)のテストデータ/自動テスト整備
☐ 局・半荘進行のステート管理（親流れ/連荘/場風更新/ポイント集計）
☐ ゲーム保存/ロード（ローカルストレージ）
☐ モジュール分割（描画/ゲーム進行/AI/役判定/スコアリング）
☐ エラーハンドリング・ログ出力（デバッグ用オーバーレイ）

[デバッグ/開発補助]
☐ デバッグ配牌の選択UI（国士/七対子/一気通貫などプリセット選択）
☐ 任意牌を山/手牌に挿入するツール
☐ 役判定の詳細ログ表示（面子分解/候補/最終採用構成）

[既存の改善点]
☐ 平和/一盃口/三暗刻などの簡易判定を厳密仕様へ
☐ drawYakuInfoの14枚限定表示を、ロン時（13枚+ロン牌）の画面イベントにも対応
☐ 牌の当たり判定/オフセットの可変化（スタイル設定から変更可能に）
☐ 牌画像/フォント・配牌/打牌の見やすさ改善
